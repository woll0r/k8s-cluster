---
version: '3'

vars:
  PROJECT_DIR:
    sh: git rev-parse --show-toplevel
  CLUSTER_DIR: '{{.PROJECT_DIR}}/cluster'

env:
  KUBECONFIG: '{{.PROJECT_DIR}}/kubeconfig'

includes:
  cluster:
    taskfile: .taskfiles/cluster.yml
  precommit:
    taskfile: .taskfiles/precommit.yml
    aliases:
      - pre
  snapshot:
    taskfile: .taskfiles/snapshots.yml
  volsync:
    taskfile: .taskfiles/volsync.yml
    aliases:
      - vs

tasks:

  init:
    desc: Initialize workstation dependencies with Brew
    cmds:
      - brew install {{.DEPS}} {{.CLI_ARGS}}
    preconditions:
      - sh: command -v brew
        msg: |
          Homebrew is not installed. Using MacOS, Linux or WSL?
          Head over to https://brew.sh to get up and running.
    vars:
      DEPS: >-
        age
        direnv
        fluxcd/tap/flux
        go-task/tap/go-task
        helm
        kubernetes-cli
        kustomize
        pre-commit
        sops
